{"hierarchy":{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents","modules":[{"projects":[{"sections":[{"kind":"task","reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Getting-a-model"},{"kind":"task","reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Adding-your-model-to-Xcode"},{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Exploring-the-model-in-Xcode","kind":"task"},{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Summary","kind":"task"}],"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project"}],"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Add-the-model-to-your-project"},{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Setup-and-implement-the-classifier","projects":[{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model","sections":[{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#Setup-the-model","kind":"task"},{"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#Implement-the-classification","kind":"task"},{"kind":"task","reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#How-to-use-the-image-classifier"}]}]},{"projects":[],"reference":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Add-the-next-chapter-title-here."}],"paths":[["doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents","doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/$volume","doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Setup-and-implement-the-classifier"]]},"identifier":{"url":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model","interfaceLanguage":"swift"},"kind":"project","metadata":{"role":"project","categoryPathComponent":"Tutorial-Table-of-Contents","category":"Add the name of your tutorial here. This usually matches your project's product module name.","title":"Setup and implement the model"},"schemaVersion":{"major":0,"patch":0,"minor":3},"sections":[{"kind":"hero","title":"Setup and implement the model","chapter":"Setup and implement the classifier","estimatedTimeInMinutes":30,"content":[]},{"kind":"tasks","tasks":[{"stepsSection":[{"caption":[],"content":[{"inlineContent":[{"type":"text","text":"Create a new Swift file named "},{"code":"ImageClassifier.swift","type":"codeVoice"},{"type":"text","text":"."},{"text":" ","type":"text"},{"text":"This is going to be the main file where we implement the operation of classifing the image.","type":"text"}],"type":"paragraph"}],"media":"02-01-create-class.png","code":null,"runtimePreview":null,"type":"step"},{"media":null,"code":"01-import-frameworks.swift","runtimePreview":null,"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Start by importing "},{"type":"codeVoice","code":"UIKit"},{"type":"text","text":", "},{"type":"codeVoice","code":"Vision"},{"text":" and ","type":"text"},{"code":"CoreML","type":"codeVoice"},{"text":" at the top of the file. We need this frameworks in the course of this tutorial.","type":"text"}]}],"caption":[]},{"type":"step","media":null,"caption":[],"content":[{"inlineContent":[{"type":"text","text":"Go ahead and create a class in the Swift file."}],"type":"paragraph"}],"code":"02-create-class.swift","runtimePreview":null},{"caption":[{"name":"Note","style":"note","type":"aside","content":[{"inlineContent":[{"text":"We use a static variable to store a single instance of your model in our app. Instantiating a Core ML model is pretty resource intensive, so we want to instantiate the class once and only once.","type":"text"}],"type":"paragraph"}]}],"code":"03-add-setup-method.swift","type":"step","content":[{"type":"paragraph","inlineContent":[{"text":"We will start by loading and setting up the model in code.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Add a static constant "},{"type":"codeVoice","code":"model"},{"text":" and function ","type":"text"},{"code":"setupModel","type":"codeVoice"},{"text":" to the class. We are going to setup the model in the next steps.","type":"text"}]}],"runtimePreview":null,"media":null},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"First, we have to create a "},{"code":"MLModelConfiguration","type":"codeVoice"},{"type":"text","text":"."},{"text":" ","type":"text"},{"type":"text","text":"This is used to define settings for the way in which a model is executed."},{"text":" ","type":"text"},{"text":"You can for example specify that the model should use all compute units, CPU and Neural Engine or CPU only.","type":"text"}]}],"code":"04-chapter2.swift","runtimePreview":null,"caption":[],"media":null,"type":"step"},{"code":"05-chapter2.swift","runtimePreview":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"We use the "},{"type":"codeVoice","code":"try?"},{"type":"text","text":" syntax to get an "},{"code":"Optional<SqueezeNet>","type":"codeVoice"},{"type":"text","text":" back."},{"type":"text","text":" "},{"type":"text","text":"The variable "},{"type":"codeVoice","code":"modelWrapper"},{"type":"text","text":" is "},{"type":"codeVoice","code":"nil"},{"text":" if the provided configuration is invalid or the model could not be found in the bundle.","type":"text"}]}],"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Now, create an instance of the model wrapper class (e.g. of the class "},{"type":"codeVoice","code":"SqueezeNet"},{"type":"text","text":" when using the SqueezeNet model)."},{"type":"text","text":" "},{"type":"text","text":"This class is autogenerated by Xcode after adding a "},{"type":"codeVoice","code":".mlmodel"},{"type":"text","text":" and we are going to look at the content soon."}]}],"media":null},{"caption":[{"content":[{"inlineContent":[{"type":"text","text":""},{"type":"text","text":" "},{"type":"text","text":"As we don’t do any runtime changes to the model or load the model from the network, we do not need to use proper error handling here."},{"text":" ","type":"text"},{"type":"text","text":"If instantiating the model wrapper fails, we will notice during development and get a "},{"type":"codeVoice","code":"fatalError"},{"text":" – so the App crashes.","type":"text"}],"type":"paragraph"}],"type":"aside","style":"warning","name":"Warning"}],"runtimePreview":null,"content":[],"type":"step","media":null,"code":null},{"media":null,"code":null,"runtimePreview":null,"type":"step","content":[{"inlineContent":[{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/bundle","type":"reference"},{"text":" is a class from the Foundation Framework. It is a class representing your application executable during runtime.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"During compilation of your app, a bundle is being composed. The main application bundle can be accessed using "},{"type":"codeVoice","code":"Bundle.main"},{"type":"text","text":"."}],"type":"paragraph"}],"caption":[{"name":"Note","type":"aside","style":"note","content":[{"inlineContent":[{"text":"As a rule of thumb you can say, that all resources go into your application bundle. For example images, sound files and localization string files can be accessed via the bundle. In our case all relevant model data (our ","type":"text"},{"code":".mlmodel","type":"codeVoice"},{"text":" file) is being copied to the application bundle.","type":"text"}],"type":"paragraph"}]}]},{"runtimePreview":null,"type":"step","code":null,"content":[{"inlineContent":[{"type":"text","text":"As you might know, Apple’s Platforms support a few different Machine Learning tasks like"},{"text":" ","type":"text"},{"text":"Image, Text, Sound, and Activity Classification","type":"text"},{"type":"text","text":" "},{"type":"text","text":"just to name a few."}],"type":"paragraph"}],"media":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You might have recognized that all of the given examples have different types of input data. Image Classification needs an image input, Text Classification needs a text, Sound Classification needs a sound and Activity Classification needs raw movement data in a specific format."}]}]},{"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Everything we did by now, is loading and instantiating our model wrapper from the "},{"type":"codeVoice","code":"Bundle"},{"type":"text","text":"."}]}],"code":null,"runtimePreview":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You might have wondered what the auto-generated model wrapper does and why it exists. So let’s take a quick view at the auto-generated code."},{"type":"text","text":" "},{"type":"text","text":"You can do that by opening your "},{"code":"SqueezeNet.mlmodel","type":"codeVoice"},{"type":"text","text":" in the Project Navigator and clicking on the label "},{"type":"codeVoice","code":"SqueezeNet"},{"text":" right next to the ","type":"text"},{"type":"codeVoice","code":"Model Class"},{"type":"text","text":" label."}]},{"type":"aside","style":"warning","content":[{"inlineContent":[{"type":"text","text":"Make sure that you compiled your app as the code of the class is generated during compilation. You may have to comment out the existing code in order to compile successfully."}],"type":"paragraph"}],"name":"Warning"}],"media":"02-02-click-model-class.png"},{"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You will be greeted by a wall of text. But no worries, we just need to take a quick look at it, as the "},{"type":"codeVoice","code":"Vision"},{"type":"text","text":" framework will do the heavy lifting for us."}]}],"media":null,"code":null,"caption":[],"runtimePreview":null},{"type":"step","media":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"This file should contain three classes."},{"text":" ","type":"text"},{"type":"text","text":"Depending on the name of your model it has a class for input, output and for loading and prediction."}]}],"code":"01-SqueezeNet.swift","runtimePreview":null,"caption":[]},{"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Because working with them is not that straight forward, we get a few so called "},{"type":"codeVoice","code":"convenience"},{"text":" initializer by default. As the name implies a ","type":"text"},{"code":"convenience init","type":"codeVoice"},{"type":"text","text":" should simplify instantiating an object of this class."},{"text":" ","type":"text"},{"text":"For example we get options to create a model input from ","type":"text"},{"type":"codeVoice","code":"UIImage"},{"text":" and ","type":"text"},{"code":"URL","type":"codeVoice"},{"type":"text","text":"."}]}],"code":"SqueezeNet-02.swift","media":null,"runtimePreview":null,"type":"step","content":[{"inlineContent":[{"type":"text","text":"The "},{"code":"SqueezeNetInput","type":"codeVoice"},{"type":"text","text":" class has an important variable "},{"code":"image","type":"codeVoice"},{"text":" which is the input for the model.","type":"text"},{"type":"text","text":" "},{"type":"codeVoice","code":"CVPixelBuffer"},{"text":" is a very low-level class from ","type":"text"},{"code":"CoreVideo","type":"codeVoice"},{"text":" and stores images in a buffer.","type":"text"}],"type":"paragraph"}]},{"caption":[],"code":"SqueezeNet-03.swift","type":"step","runtimePreview":null,"media":null,"content":[{"inlineContent":[{"type":"text","text":"The output class provides a dictionary which maps class labels to their calculated likelihood."}],"type":"paragraph"}]},{"media":null,"code":"SqueezeNet-04.swift","runtimePreview":null,"type":"step","content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"SqueezeNet","type":"codeVoice"},{"type":"text","text":" class has exactly the initializer, which we used in the "},{"code":"ImageClassifier","type":"codeVoice"},{"type":"text","text":" class."},{"type":"text","text":" "},{"text":"It also has methods to predict an output from a given output.","type":"text"}]}],"caption":[{"inlineContent":[{"text":"You may have noticed that the input of the model takes only input buffers of size 227x227 pixels.","type":"text"}],"type":"paragraph"}]},{"caption":[],"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"But how do we convert our images to the required format?"},{"type":"text","text":" "},{"type":"text","text":"Thats where the Vision Framework comes into play."},{"type":"text","text":" "},{"type":"text","text":"The Vision Framework provides features to execute common computer vision problems like text recognition on still images and videos."},{"text":" ","type":"text"},{"type":"text","text":"It also simplifies dealing with Core ML models so we are going to setup a "},{"type":"codeVoice","code":"VNCoreMLModel"},{"text":" next.","type":"text"}]}],"code":null,"media":null,"runtimePreview":null},{"media":null,"content":[{"inlineContent":[{"type":"text","text":"Go ahead and create a "},{"type":"codeVoice","code":"VNCoreMLModel"},{"text":" from the underlying ","type":"text"},{"code":"MLModel","type":"codeVoice"},{"type":"text","text":" of the "},{"code":"SqueezeNet","type":"codeVoice"},{"text":" wrapper instance.","type":"text"}],"type":"paragraph"}],"runtimePreview":null,"caption":[],"type":"step","code":"06-chapter2.swift"},{"type":"step","caption":[],"media":null,"content":[{"type":"paragraph","inlineContent":[{"text":"We now have successfully setup our model and will look at how to use this ","type":"text"},{"code":"VNCoreMLModel","type":"codeVoice"},{"type":"text","text":" in the next section."}]}],"runtimePreview":null,"code":null}],"contentSection":[{"mediaPosition":"trailing","kind":"contentAndMedia","content":[{"inlineContent":[{"type":"text","text":"In this section we are going to load and instantiate the model."}],"type":"paragraph"}]}],"anchor":"Setup-the-model","title":"Setup the model"},{"title":"Implement the classification","stepsSection":[{"caption":[],"content":[{"type":"paragraph","inlineContent":[{"text":"Create a new Swift file ","type":"text"},{"type":"codeVoice","code":"ImageClassificationPredication.swift"},{"text":" and add a struct.","type":"text"},{"text":" ","type":"text"},{"text":"This will store a single result of your classification operation. E.g. label of “elephant” and confidence ","type":"text"},{"code":"0.94","type":"codeVoice"},{"type":"text","text":"."}]}],"media":null,"code":"Section2-01.swift","type":"step","runtimePreview":null},{"media":null,"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Add a typealias "},{"code":"ImageClassificationHandler","type":"codeVoice"},{"type":"text","text":" to the top of the file "},{"type":"codeVoice","code":"ImageClassifier.swift"},{"type":"text","text":"."},{"type":"text","text":" "},{"type":"text","text":"This type will be used as a shorthand for the result closure. It returns an array of "},{"type":"codeVoice","code":"ImageClassificationPredication"},{"type":"text","text":" and does not exect any return types."}]}],"type":"step","caption":[{"type":"paragraph","inlineContent":[{"text":"A typealias works like a shorthand. Everywhere you write ","type":"text"},{"code":"ImageClassificationHandler","type":"codeVoice"},{"text":", it is the same like replacing it with the right side.","type":"text"}]}],"code":"07-chapter2.swift"},{"caption":[{"inlineContent":[{"type":"text","text":"A handler is a closure being passed from the caller to react to the results."}],"type":"paragraph"}],"media":null,"runtimePreview":null,"code":null,"content":[{"inlineContent":[{"text":"A ","type":"text"},{"type":"codeVoice","code":"VNRequest"},{"text":" is used to execute an image classification operation.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Each request get’s an image input and has a handler which is called with the image classification predictions calculated with the model."}],"type":"paragraph"}],"type":"step"},{"caption":[],"media":null,"content":[{"inlineContent":[{"type":"text","text":"We store a reference of each request feed into the "},{"code":"ImageClassifier","type":"codeVoice"},{"type":"text","text":" along with the provided handler."}],"type":"paragraph"}],"code":"08-chapter2.swift","runtimePreview":null,"type":"step"},{"code":"CGImagePropertyOrientation+Extensions.swift","runtimePreview":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"We create an initializer which maps the orientation of a ","type":"text"},{"code":"UIImage","type":"codeVoice"},{"type":"text","text":" (which we can easily handle) to a "},{"type":"codeVoice","code":"CGImagePropertyOrientation"},{"type":"text","text":"."}]}],"type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a new file and add an extension to the "},{"type":"codeVoice","code":"CGImagePropertyOrientation"},{"text":".","type":"text"},{"type":"text","text":" "},{"text":"When feeding an image into the Vision framework we need to provide the image orientiation as a ","type":"text"},{"code":"CoreGraphics","type":"codeVoice"},{"text":" image orientation.","type":"text"}]}],"media":null},{"media":null,"code":"09-chapter2.swift","content":[{"inlineContent":[{"type":"text","text":"Add a "},{"code":"makePredictions","type":"codeVoice"},{"text":" function.","type":"text"},{"text":" ","type":"text"},{"text":"First, obtain the ","type":"text"},{"type":"codeVoice","code":"CGImagePropertyOrientation"},{"type":"text","text":" and the "},{"code":"CGImage","type":"codeVoice"},{"type":"text","text":" from the provided "},{"code":"UIImage","type":"codeVoice"},{"type":"text","text":"."}],"type":"paragraph"}],"runtimePreview":null,"caption":[{"type":"paragraph","inlineContent":[{"text":"Next, create an image classification request. We are going to implement the function ","type":"text"},{"type":"codeVoice","code":"createImageClassificationRequest()"},{"type":"text","text":" in a further step."}]}],"type":"step"},{"code":"10-chapter2.swift","type":"step","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Store the request in the "},{"type":"codeVoice","code":"predictionHandlers"},{"type":"text","text":" array with the request as the key and the completion handler passed to the function as the value. This is going to be called when the following request handler finished the classification job."}]}],"runtimePreview":null,"caption":[{"type":"paragraph","inlineContent":[{"type":"text","text":"So create the "},{"code":"VNImageRequestHandler","type":"codeVoice"},{"type":"text","text":" with a given image and the previously obtained orientation. After that, call the throwing function "},{"code":"perform","type":"codeVoice"},{"type":"text","text":" on the handler which takes an array of "},{"code":"VNRequest","type":"codeVoice"},{"type":"text","text":" as parameters."}]}],"media":null},{"type":"step","runtimePreview":null,"content":[{"inlineContent":[{"type":"text","text":"You can see, that there is an error "},{"type":"codeVoice","code":"Cannot find 'createImageClassificationRequest' in scope"},{"type":"text","text":". We are going to fix that now."}],"type":"paragraph"}],"caption":[{"inlineContent":[{"text":"Add this method to create a new ","type":"text"},{"code":"VNCoreMLRequest","type":"codeVoice"},{"type":"text","text":". It uses the staticly available model which we setup earlier. We use a image crop and scale options of "},{"code":".centerCrop","type":"codeVoice"},{"type":"text","text":" – there may be cases where you want a different behaviour, but for our use case this is good."}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Again, you see a warning that "},{"type":"codeVoice","code":"visionRequestHandler"},{"type":"text","text":" is not available. We will implement this in the next step."}]}],"name":"Warning","type":"aside","style":"warning"}],"code":"11-chapter2.swift","media":null},{"code":"12-chapter2.swift","content":[{"type":"paragraph","inlineContent":[{"text":"As the final step, we implement the ","type":"text"},{"code":"visionRequestHandler","type":"codeVoice"},{"text":".","type":"text"},{"type":"text","text":" "},{"text":"This will be the function which get’s called every time a ","type":"text"},{"code":"VNCoreMLRequest","type":"codeVoice"},{"type":"text","text":" succeeds or fails and handles calling the right completion functions."}]}],"type":"step","media":null,"runtimePreview":null,"caption":[{"inlineContent":[{"type":"text","text":"Based on the request which get’s completed, we get the handler function from the "},{"type":"codeVoice","code":"predictionHandlers"},{"type":"text","text":" dictionary. Next, we need an optional predictions array in which we will store the results produced by the model."}],"type":"paragraph"}]},{"caption":[{"type":"paragraph","inlineContent":[{"text":"We also check if the request failed with an error or has no results.","type":"text"}]}],"type":"step","media":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Next, we use a defer callback to call the retrieved predicition handler with the obtained results."}]}],"code":"13-chapter2.swift","runtimePreview":null},{"code":"14-chapter2.swift","type":"step","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"text":"We now cast the request’s results as an ","type":"text"},{"type":"codeVoice","code":"VNClassificationObservation"},{"type":"text","text":" array."}]}],"caption":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Image classifiers only produce classification observations. However, other Core ML model types can produce other observations. For example, a style transfer model produces "},{"type":"codeVoice","code":"VNPixelBufferObservation"},{"type":"text","text":" instances."}]}],"name":"Note","type":"aside","style":"note"}],"media":null}],"contentSection":[{"kind":"contentAndMedia","mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Setup the additional models we need for the "},{"code":"ImageClassifier","type":"codeVoice"},{"type":"text","text":"."}]}]}],"anchor":"Implement-the-classification"},{"title":"How to use the image classifier","contentSection":[{"mediaPosition":"trailing","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Let’s look at what we build. You may struggle to understand how data flows here, so we will do a short recap."}]}],"kind":"contentAndMedia"}],"anchor":"How-to-use-the-image-classifier","stepsSection":[{"runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"We setup a "},{"code":"VNCoreMLModel","type":"codeVoice"},{"text":" with our image classifier model ","type":"text"},{"code":"SqueezeNet","type":"codeVoice"},{"text":".","type":"text"}]}],"media":null,"type":"step","caption":[],"code":null},{"caption":[],"media":null,"code":"01-Example.swift","runtimePreview":null,"content":[{"type":"paragraph","inlineContent":[{"text":"We as a developer can now create an instance of the ","type":"text"},{"type":"codeVoice","code":"ImageClassifier"},{"text":" class and call ","type":"text"},{"code":"makePredictions","type":"codeVoice"},{"type":"text","text":" with an image."},{"type":"text","text":" "},{"type":"text","text":"The results are available in the trailing closure."}]}],"type":"step"}]}]}],"variants":[{"paths":["\/tutorials\/ml-playground\/02-setup-implement-model"],"traits":[{"interfaceLanguage":"swift"}]}],"references":{"08-chapter2.swift":{"fileType":"swift","syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    ","}"],"highlights":[{"line":11},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17}],"fileName":"ImageClassifier.swift","identifier":"08-chapter2.swift","type":"file"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/02-setup-implement-model#Setup-the-model":{"url":"\/tutorials\/ml-playground\/02-setup-implement-model#Setup-the-model","type":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#Setup-the-model","role":"pseudoSymbol","abstract":[],"title":"Setup the model","kind":"section"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/01-Setup-the-project#Exploring-the-model-in-Xcode":{"url":"\/tutorials\/ml-playground\/01-setup-the-project#Exploring-the-model-in-Xcode","type":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Exploring-the-model-in-Xcode","role":"pseudoSymbol","abstract":[{"type":"text","text":"Learn how to add an Core ML file to your app and explore the built-in capabilities of Xcode."}],"title":"Exploring the model in Xcode","kind":"section"},"01-Example.swift":{"type":"file","fileType":"swift","syntax":"swift","identifier":"01-Example.swift","fileName":"Example.swift","content":["let imageClassifier = imageClassifier()","","\/\/ Load an image from Asset Catalogue","let image = UIImage(named: \"example\")","","do {","    ","    \/\/ Make a prediction and print the results.","    try imageClassifier.makePredictions(","        for: image","    ) { predictions in","        ","        if let predictions {","            ","            for prediction in predictions {","                print(\"\\(prediction.classification): \\(prediction.confidence)\")","            }","            ","        } else {","            print(\"No result from image classifier.\")","        }","        ","    }","    ","} catch {","    print(\"Vision was unable to make a prediction...\\n\\n\\(error.localizedDescription)\")","}"],"highlights":[]},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/02-setup-implement-model#How-to-use-the-image-classifier":{"url":"\/tutorials\/ml-playground\/02-setup-implement-model#How-to-use-the-image-classifier","type":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#How-to-use-the-image-classifier","role":"pseudoSymbol","abstract":[],"title":"How to use the image classifier","kind":"section"},"doc://com.lambdadigamma.mllab/tutorials/Tutorial-Table-of-Contents/Setup-and-implement-the-classifier":{"url":"\/tutorials\/tutorial-table-of-contents\/setup-and-implement-the-classifier","type":"topic","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Setup-and-implement-the-classifier","role":"article","abstract":[],"title":"Setup and implement the classifier","kind":"article"},"05-chapter2.swift":{"type":"file","fileType":"swift","syntax":"swift","identifier":"05-chapter2.swift","fileName":"ImageClassifier.swift","content":["import UIKit","import Vision","import CoreML","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {","        ","        let config = MLModelConfiguration()","        config.computeUnits = MLComputeUnits.cpuAndGPU","        ","        let squeezeNet = try? SqueezeNet(","            configuration: config","        )","        ","        guard let squeezeNet = squeezeNet else {","            fatalError(\"App failed to create a model instance.\")","        }","        ","    }","    ","}"],"highlights":[{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21}]},"SqueezeNet-02.swift":{"fileType":"swift","identifier":"SqueezeNet-02.swift","type":"file","syntax":"swift","fileName":"SqueezeNet.swift","highlights":[{"line":7},{"line":8},{"line":9},{"line":12},{"line":13},{"line":14},{"line":15},{"line":16},{"line":17},{"line":18},{"line":19},{"line":20},{"line":21},{"line":22},{"line":23},{"line":24},{"line":25},{"line":26},{"line":27},{"line":28},{"line":29},{"line":30},{"line":31}],"content":["import CoreML","","","\/\/\/ Model Prediction Input Type","class SqueezeNetInput : MLFeatureProvider {","    ","    \/\/\/ Input image to be classified as color (kCVPixelFormatType_32BGRA) image buffer, 227 pixels wide by 227 pixels high","    var image: CVPixelBuffer","    ","    \/\/ ...","    ","    init(image: CVPixelBuffer) {","        self.image = image","    }","    ","    convenience init(imageWith image: CGImage) throws {","        \/\/ ...","    }","    ","    convenience init(imageAt image: URL) throws {","        \/\/ ...","    }","    ","    func setImage(with image: CGImage) throws {","        \/\/ ...","    }","    ","    func setImage(with image: URL) throws {","        \/\/ ...","    }","    ","}","","\/\/\/ Model Prediction Output Type","class SqueezeNetOutput : MLFeatureProvider {","    ","    \/\/ ...","    ","}","","\/\/\/ Class for model loading and prediction","class SqueezeNet {","    ","    \/\/ ...","    ","}"]},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/01-Setup-the-project#Adding-your-model-to-Xcode":{"url":"\/tutorials\/ml-playground\/01-setup-the-project#Adding-your-model-to-Xcode","type":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Adding-your-model-to-Xcode","role":"pseudoSymbol","abstract":[{"type":"text","text":"Learn how to add an Core ML file to your app and explore the built-in capabilities of Xcode."}],"title":"Adding your model to Xcode","kind":"section"},"02-create-class.swift":{"type":"file","fileType":"swift","syntax":"swift","identifier":"02-create-class.swift","fileName":"ImageClassifier.swift","content":["import UIKit","import Vision","import CoreML","","class ImageClassifier {","    ","    ","    ","}"],"highlights":[{"line":4},{"line":5},{"line":6},{"line":7},{"line":8},{"line":9}]},"doc://com.lambdadigamma.mllab/tutorials/Tutorial-Table-of-Contents/Add-the-model-to-your-project":{"url":"\/tutorials\/tutorial-table-of-contents\/add-the-model-to-your-project","type":"topic","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Add-the-model-to-your-project","role":"article","abstract":[],"title":"Add the model to your project","kind":"article"},"10-chapter2.swift":{"type":"file","fileType":"swift","syntax":"swift","identifier":"10-chapter2.swift","fileName":"ImageClassifier.swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","        predictionHandlers[imageClassificationRequest] = completionHandler","        ","        let handler = VNImageRequestHandler(","            cgImage: photoImage,","            orientation: orientation","        )","        ","        try handler.perform([imageClassificationRequest])","        ","    }","    ","}"],"highlights":[{"line":30},{"line":31},{"line":32},{"line":33},{"line":34},{"line":35},{"line":36},{"line":37},{"line":38}]},"doc://com.lambdadigamma.mllab/tutorials/Tutorial-Table-of-Contents":{"url":"\/tutorials\/tutorial-table-of-contents","type":"topic","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents","role":"overview","abstract":[{"type":"text","text":"Add and implement an image classifier Core ML model into your application."}],"title":"Implementing an image classifier with Core ML","kind":"overview"},"03-add-setup-method.swift":{"content":["import UIKit","import Vision","import CoreML","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {","        ","        \/\/ todo: implement this","        ","    }","    ","}"],"type":"file","syntax":"swift","fileName":"ImageClassifier.swift","highlights":[{"line":7},{"line":9},{"line":10},{"line":11},{"line":12},{"line":13}],"fileType":"swift","identifier":"03-add-setup-method.swift"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/01-Setup-the-project#Getting-a-model":{"url":"\/tutorials\/ml-playground\/01-setup-the-project#Getting-a-model","type":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Getting-a-model","role":"pseudoSymbol","abstract":[{"type":"text","text":"Learn how to add an Core ML file to your app and explore the built-in capabilities of Xcode."}],"title":"Getting a model","kind":"section"},"Section2-01.swift":{"fileType":"swift","syntax":"swift","content":["import Foundation","import Vision","","struct ImageClassificationPredication {","    ","    let label: String","    ","    let confidence: VNConfidence","    ","}"],"highlights":[],"identifier":"Section2-01.swift","fileName":"ImageClassificationPredication.swift","type":"file"},"02-02-click-model-class.png":{"alt":"","variants":[{"url":"\/images\/02-02-click-model-class.png","traits":["1x","light"]}],"type":"image","identifier":"02-02-click-model-class.png"},"06-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {","        ","        let config = MLModelConfiguration()","        config.computeUnits = MLComputeUnits.cpuAndGPU","        ","        let squeezeNet = try? SqueezeNet(","            configuration: config","        )","        ","        guard let squeezeNet = squeezeNet else {","            fatalError(\"App failed to create a model instance.\")","        }","        ","        let underlyingModel = squeezeNet.model","        ","        guard let visionModel = try? VNCoreMLModel(","            for: underlyingModel","        ) else {","            fatalError(\"App failed to create a `VNCoreMLModel` instance.\")","        }","        ","        return visionModel","        ","    }","    ","}"],"highlights":[],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"06-chapter2.swift","type":"file"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/02-setup-implement-model":{"abstract":[],"role":"project","kind":"project","url":"\/tutorials\/ml-playground\/02-setup-implement-model","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model","type":"topic","title":"Setup and implement the model","estimatedTime":"30min"},"SqueezeNet-03.swift":{"syntax":"swift","content":["import CoreML","","","\/\/\/ Model Prediction Input Type","class SqueezeNetInput : MLFeatureProvider {","    ","    \/\/\/ Input image to be classified as color (kCVPixelFormatType_32BGRA) image buffer, 227 pixels wide by 227 pixels high","    var image: CVPixelBuffer","    ","    \/\/ ...","    ","    init(image: CVPixelBuffer) {","        self.image = image","    }","    ","    convenience init(imageWith image: CGImage) throws {","        \/\/ ...","    }","    ","    convenience init(imageAt image: URL) throws {","        \/\/ ...","    }","    ","    func setImage(with image: CGImage) throws {","        \/\/ ...","    }","    ","    func setImage(with image: URL) throws {","        \/\/ ...","    }","    ","}","","\/\/\/ Model Prediction Output Type","class SqueezeNetOutput : MLFeatureProvider {","    ","    \/\/\/ Source provided by CoreML","    private let provider : MLFeatureProvider","    ","    \/\/\/ Probability of each category as dictionary of strings to doubles","    var classLabelProbs: [String : Double] {","        return self.provider.featureValue(for: \"classLabelProbs\")!.dictionaryValue as! [String : Double]","    }","    ","    \/\/ ...","    ","}","","\/\/\/ Class for model loading and prediction","class SqueezeNet {","    ","    \/\/ ...","    ","}"],"highlights":[{"line":37},{"line":38},{"line":39},{"line":40},{"line":41},{"line":42},{"line":43},{"line":44}],"fileName":"SqueezeNet.swift","fileType":"swift","identifier":"SqueezeNet-03.swift","type":"file"},"CGImagePropertyOrientation+Extensions.swift":{"syntax":"swift","content":["import UIKit","import ImageIO","","extension CGImagePropertyOrientation {","    ","    init(_ orientation: UIImage.Orientation) {","        switch orientation {","            case .up: self = .up","            case .down: self = .down","            case .left: self = .left","            case .right: self = .right","            case .upMirrored: self = .upMirrored","            case .downMirrored: self = .downMirrored","            case .leftMirrored: self = .leftMirrored","            case .rightMirrored: self = .rightMirrored","            @unknown default: self = .up","        }","    }","    ","}"],"highlights":[],"fileName":"CGImagePropertyOrientation+Extensions.swift","fileType":"swift","identifier":"CGImagePropertyOrientation+Extensions.swift","type":"file"},"https://developer.apple.com/documentation/foundation/bundle":{"type":"link","titleInlineContent":[{"type":"text","text":"Bundle"}],"url":"https:\/\/developer.apple.com\/documentation\/foundation\/bundle","title":"Bundle","identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/bundle"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/01-Setup-the-project#Summary":{"abstract":[{"type":"text","text":"Learn how to add an Core ML file to your app and explore the built-in capabilities of Xcode."}],"role":"pseudoSymbol","kind":"section","url":"\/tutorials\/ml-playground\/01-setup-the-project#Summary","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project#Summary","type":"section","title":"Summary"},"04-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {","        ","        let config = MLModelConfiguration()","        config.computeUnits = MLComputeUnits.cpuAndGPU","        ","    }","    ","}"],"highlights":[{"line":11},{"line":12}],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"04-chapter2.swift","type":"file"},"SqueezeNet-04.swift":{"fileType":"swift","highlights":[{"line":52},{"line":53},{"line":56},{"line":57},{"line":58},{"line":59},{"line":60},{"line":61},{"line":62},{"line":63},{"line":64},{"line":65},{"line":66},{"line":67},{"line":68},{"line":69},{"line":70},{"line":71},{"line":72},{"line":73},{"line":74},{"line":75}],"fileName":"SqueezeNet.swift","type":"file","content":["import CoreML","","","\/\/\/ Model Prediction Input Type","class SqueezeNetInput : MLFeatureProvider {","    ","    \/\/\/ Input image to be classified as color (kCVPixelFormatType_32BGRA) image buffer, 227 pixels wide by 227 pixels high","    var image: CVPixelBuffer","    ","    \/\/ ...","    ","    init(image: CVPixelBuffer) {","        self.image = image","    }","    ","    convenience init(imageWith image: CGImage) throws {","        \/\/ ...","    }","    ","    convenience init(imageAt image: URL) throws {","        \/\/ ...","    }","    ","    func setImage(with image: CGImage) throws {","        \/\/ ...","    }","    ","    func setImage(with image: URL) throws {","        \/\/ ...","    }","    ","}","","\/\/\/ Model Prediction Output Type","class SqueezeNetOutput : MLFeatureProvider {","    ","    \/\/\/ Source provided by CoreML","    private let provider : MLFeatureProvider","    ","    \/\/\/ Probability of each category as dictionary of strings to doubles","    var classLabelProbs: [String : Double] {","        return self.provider.featureValue(for: \"classLabelProbs\")!.dictionaryValue as! [String : Double]","    }","    ","    \/\/ ...","    ","}","","\/\/\/ Class for model loading and prediction","class SqueezeNet {","    ","    let model: MLModel","    ","    \/\/ ...","    ","    \/\/\/ Construct a model with configuration","    convenience init(configuration: MLModelConfiguration) throws {","        try self.init(contentsOf: type(of:self).urlOfModelInThisBundle, configuration: configuration)","    }","    ","    \/\/ ...","    ","    \/\/\/ Make a prediction using the structured interface","    func prediction(input: SqueezeNetInput) throws -> SqueezeNetOutput {","        return try self.prediction(input: input, options: MLPredictionOptions())","    }","    ","    \/\/\/ Make a prediction using the structured interface","    func prediction(input: SqueezeNetInput, options: MLPredictionOptions) throws -> SqueezeNetOutput {","        let outFeatures = try model.prediction(from: input, options:options)","        return SqueezeNetOutput(features: outFeatures)","    }","    ","    \/\/ ...","    ","}"],"syntax":"swift","identifier":"SqueezeNet-04.swift"},"11-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","        predictionHandlers[imageClassificationRequest] = completionHandler","        ","        let handler = VNImageRequestHandler(","            cgImage: photoImage,","            orientation: orientation","        )","        ","        try handler.perform([imageClassificationRequest])","        ","    }","    ","    private func createImageClassificationRequest() -> VNCoreMLRequest {","        ","        let imageClassificationRequest = VNCoreMLRequest(","            model: Self.model,","            completionHandler: visionRequestHandler","        )","        ","        imageClassificationRequest.imageCropAndScaleOption = .centerCrop","        ","        return imageClassificationRequest","    }","    ","}"],"highlights":[{"line":41},{"line":42},{"line":43},{"line":44},{"line":45},{"line":46},{"line":47},{"line":48},{"line":49},{"line":50},{"line":51},{"line":52}],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"11-chapter2.swift","type":"file"},"01-import-frameworks.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML"],"highlights":[],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"01-import-frameworks.swift","type":"file"},"07-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {","        ","        let config = MLModelConfiguration()","        config.computeUnits = MLComputeUnits.cpuAndGPU","        ","        let squeezeNet = try? SqueezeNet(","            configuration: config","        )","        ","        guard let squeezeNet = squeezeNet else {","            fatalError(\"App failed to create a model instance.\")","        }","        ","        let underlyingModel = squeezeNet.model","        ","        guard let visionModel = try? VNCoreMLModel(","            for: underlyingModel","        ) else {","            fatalError(\"App failed to create a `VNCoreMLModel` instance.\")","        }","        ","        return visionModel","        ","    }","    ","}"],"highlights":[],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"07-chapter2.swift","type":"file"},"13-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","        predictionHandlers[imageClassificationRequest] = completionHandler","        ","        let handler = VNImageRequestHandler(","            cgImage: photoImage,","            orientation: orientation","        )","        ","        try handler.perform([imageClassificationRequest])","        ","    }","    ","    private func createImageClassificationRequest() -> VNCoreMLRequest {","        ","        let imageClassificationRequest = VNCoreMLRequest(","            model: Self.model,","            completionHandler: visionRequestHandler","        )","        ","        imageClassificationRequest.imageCropAndScaleOption = .centerCrop","        ","        return imageClassificationRequest","    }","    ","    private func visionRequestHandler(_ request: VNRequest, error: Error?) {","        ","        guard let predictionHandler = predictionHandlers.removeValue(","            forKey: request","        ) else {","            fatalError(\"Every request must have a prediction handler.\")","        }","        ","        var predictions: [ImageClassificationPredication]? = nil","        ","        \/\/ Call the client's completion handler after the method returns.","        defer {","            \/\/ Send the predictions back to the client.","            predictionHandler(predictions)","        }","        ","        if let error = error {","            print(\"Vision image classification error: \\(error.localizedDescription)\")","            return","        }","        ","        if request.results == nil {","            print(\"Vision request had no results.\")","            return","        }","        ","        \/\/ ...","        ","    }","    ","}"],"highlights":[{"line":63},{"line":64},{"line":65},{"line":66},{"line":67},{"line":68},{"line":69},{"line":70},{"line":71},{"line":72},{"line":73},{"line":74},{"line":75},{"line":76},{"line":77},{"line":78}],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"13-chapter2.swift","type":"file"},"09-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","    }","    ","}"],"highlights":[],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"09-chapter2.swift","type":"file"},"12-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","        predictionHandlers[imageClassificationRequest] = completionHandler","        ","        let handler = VNImageRequestHandler(","            cgImage: photoImage,","            orientation: orientation","        )","        ","        try handler.perform([imageClassificationRequest])","        ","    }","    ","    private func createImageClassificationRequest() -> VNCoreMLRequest {","        ","        let imageClassificationRequest = VNCoreMLRequest(","            model: Self.model,","            completionHandler: visionRequestHandler","        )","        ","        imageClassificationRequest.imageCropAndScaleOption = .centerCrop","        ","        return imageClassificationRequest","    }","    ","    private func visionRequestHandler(_ request: VNRequest, error: Error?) {","        ","        guard let predictionHandler = predictionHandlers.removeValue(","            forKey: request","        ) else {","            fatalError(\"Every request must have a prediction handler.\")","        }","        ","        var predictions: [ImageClassificationPredication]? = nil","        ","        \/\/ ...","        ","    }","    ","}"],"highlights":[{"line":53},{"line":54},{"line":55},{"line":56},{"line":57},{"line":58},{"line":59},{"line":60},{"line":61},{"line":62},{"line":63},{"line":64},{"line":65},{"line":66}],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"12-chapter2.swift","type":"file"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/02-setup-implement-model#Implement-the-classification":{"abstract":[],"role":"pseudoSymbol","url":"\/tutorials\/ml-playground\/02-setup-implement-model#Implement-the-classification","kind":"section","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/02-setup-implement-model#Implement-the-classification","type":"section","title":"Implement the classification"},"01-SqueezeNet.swift":{"syntax":"swift","content":["import CoreML","","","\/\/\/ Model Prediction Input Type","class SqueezeNetInput : MLFeatureProvider {","    ","    \/\/ ...","    ","}","","\/\/\/ Model Prediction Output Type","class SqueezeNetOutput : MLFeatureProvider {","    ","    \/\/ ...","    ","}","","\/\/\/ Class for model loading and prediction","class SqueezeNet {","    ","    \/\/ ...","    ","}"],"highlights":[],"fileName":"SqueezeNet.swift","fileType":"swift","identifier":"01-SqueezeNet.swift","type":"file"},"02-01-create-class.png":{"type":"image","variants":[{"url":"\/images\/02-01-create-class.png","traits":["1x","light"]}],"alt":"","identifier":"02-01-create-class.png"},"doc://com.lambdadigamma.mllab/tutorials/ML-Playground/01-Setup-the-project":{"abstract":[{"type":"text","text":"Learn how to add an Core ML file to your app and explore the built-in capabilities of Xcode."}],"role":"project","kind":"project","url":"\/tutorials\/ml-playground\/01-setup-the-project","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/ML-Playground\/01-Setup-the-project","type":"topic","title":"Add the model to your project","estimatedTime":"10min"},"14-chapter2.swift":{"syntax":"swift","content":["import UIKit","import Vision","import CoreML","","typealias ImageClassificationHandler = (_ predictions: [ImageClassificationPredication]?) -> Void","","class ImageClassifier {","    ","    static let model = setupModel()","    ","    static func setupModel() -> VNCoreMLModel {}","    ","    \/\/ MARK: - Request Handling -","    ","    private var predictionHandlers = [VNRequest: ImageClassificationHandler]()","    ","    func makePredictions(","        for photo: UIImage,","        completionHandler: @escaping ImageClassificationHandler","    ) throws {","        ","        let orientation = CGImagePropertyOrientation(photo.imageOrientation)","        ","        guard let photoImage = photo.cgImage else {","            fatalError(\"Photo doesn't have underlying CGImage.\")","        }","        ","        let imageClassificationRequest = createImageClassificationRequest()","        ","        predictionHandlers[imageClassificationRequest] = completionHandler","        ","        let handler = VNImageRequestHandler(","            cgImage: photoImage,","            orientation: orientation","        )","        ","        try handler.perform([imageClassificationRequest])","        ","    }","    ","    private func createImageClassificationRequest() -> VNCoreMLRequest {","        ","        let imageClassificationRequest = VNCoreMLRequest(","            model: Self.model,","            completionHandler: visionRequestHandler","        )","        ","        imageClassificationRequest.imageCropAndScaleOption = .centerCrop","        ","        return imageClassificationRequest","    }","    ","    private func visionRequestHandler(_ request: VNRequest, error: Error?) {","        ","        guard let predictionHandler = predictionHandlers.removeValue(","            forKey: request","        ) else {","            fatalError(\"Every request must have a prediction handler.\")","        }","        ","        var predictions: [ImageClassificationPredication]? = nil","        ","        \/\/ Call the client's completion handler after the method returns.","        defer {","            \/\/ Send the predictions back to the client.","            predictionHandler(predictions)","        }","        ","        if let error = error {","            print(\"Vision image classification error: \\(error.localizedDescription)\")","            return","        }","        ","        if request.results == nil {","            print(\"Vision request had no results.\")","            return","        }","        ","        guard let observations = request.results as? [VNClassificationObservation] else {","            print(\"VNRequest produced the wrong result type: \\(type(of: request.results)).\")","            return","        }","        ","        predictions = observations.map { observation in","            ImageClassificationPredication(","                label: observation.identifier,","                confidence: observation.confidence","            )","        }","        ","    }","    ","}"],"highlights":[{"line":79},{"line":80},{"line":81},{"line":82},{"line":84},{"line":85},{"line":86},{"line":87},{"line":88},{"line":89},{"line":90}],"fileName":"ImageClassifier.swift","fileType":"swift","identifier":"14-chapter2.swift","type":"file"},"doc://com.lambdadigamma.mllab/tutorials/Tutorial-Table-of-Contents/Add-the-next-chapter-title-here.":{"abstract":[],"role":"article","kind":"article","url":"\/tutorials\/tutorial-table-of-contents\/add-the-next-chapter-title-here.","identifier":"doc:\/\/com.lambdadigamma.mllab\/tutorials\/Tutorial-Table-of-Contents\/Add-the-next-chapter-title-here.","type":"topic","title":"Add the next chapter title here."}}}